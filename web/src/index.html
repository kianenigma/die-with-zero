<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Die With Zero - Financial Planner</title>

	<!-- Tailwind CSS -->
	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		tailwind.config = {
			darkMode: 'class',
			theme: {
				extend: {
					colors: {
						primary: '#4a5568',
						secondary: '#2d3748',
						danger: '#c7553e',
						dangerHover: '#a84431',
					},
					fontFamily: {
						sans: ['-apple-system', 'BlinkMacSystemFont', 'SF Pro Text', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
					}
				}
			}
		}
	</script>

	<style>
		/* Minimal elegant styles */
		* {
			font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
			letter-spacing: -0.01em;
		}

		body {
			font-size: 14px;
			line-height: 1.6;
		}

		.tooltip-popup {
			position: fixed;
			background: #4a5568;
			color: #f7fafc;
			padding: 8px 12px;
			border-radius: 4px;
			font-size: 12px;
			font-weight: 400;
			white-space: normal;
			z-index: 999999;
			max-width: 350px;
			width: max-content;
			box-shadow: 0 2px 8px rgba(0,0,0,0.15);
			pointer-events: none;
			display: none;
		}

		.tooltip-popup::before {
			content: '';
			position: absolute;
			border: 6px solid transparent;
			border-right-color: #4a5568;
			left: -12px;
			top: 50%;
			transform: translateY(-50%);
		}

		.sidebar.collapsed {
			flex: 0 0 0;
			padding: 0;
			overflow: hidden;
			opacity: 0;
			border-right: none;
		}

		h1, h2, h3, h4, h5, h6 {
			font-weight: 500;
			letter-spacing: -0.02em;
		}

		input, select, button {
			font-size: 13px;
		}

		button {
			font-weight: 400;
			transition: all 0.15s ease;
		}

		button:hover {
			transform: translateY(-1px);
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}

		input:focus, select:focus {
			box-shadow: 0 0 0 2px rgba(74, 85, 104, 0.1);
		}
	</style>
</head>
<body>
	<div class="tooltip-popup" id="tooltip"></div>
	<div id="app">
		<div class="flex h-screen bg-gray-50 dark:bg-gray-900 text-gray-700 dark:text-gray-300">
			<!-- Sidebar with Parameters -->
			<div class="sidebar flex-[0_0_33.333%] p-5 overflow-y-auto border-r border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950 relative z-[100] transition-all duration-300" :class="{ collapsed: sidebarCollapsed }">
				<!-- Header with collapse button -->
				<div class="flex items-center justify-between mb-5">
					<h1 class="text-gray-800 dark:text-gray-200 text-xl font-medium">Die With Zero</h1>
					<button class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded text-xs" @click="toggleSidebar">
						{{ sidebarCollapsed ? '→' : '←' }}
					</button>
				</div>

				<!-- Basic Parameters -->
			<h2 class="text-gray-700 dark:text-gray-300 my-5 text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400 border-b border-gray-300 dark:border-gray-700 pb-2">Basic Parameters</h2>
			<div class="grid grid-cols-3 gap-2.5 mb-4">
				<div class="flex flex-col">
					<div class="flex items-center gap-1.5">
						<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Current Age</label>
						<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.currentAge">?</span>
					</div>
					<input type="number" v-model.number="params.currentAge" min="0" max="150"
						class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
				</div>
				<div class="flex flex-col">
					<div class="flex items-center gap-1.5">
						<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Projection Years</label>
						<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.projectionYears">?</span>
					</div>
					<input type="number" v-model.number="params.years" min="1" max="100"
						class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
				</div>
				<div class="flex flex-col">
					<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Currency</label>
					<select v-model="params.currency"
						class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
						<option value="$">$ (USD)</option>
						<option value="€">€ (EUR)</option>
						<option value="£">£ (GBP)</option>
						<option value="¥">¥ (JPY/CNY)</option>
						<option value="₹">₹ (INR)</option>
						<option value="₿">₿ (BTC)</option>
					</select>
				</div>
			</div>

			<!-- Income Parameters -->
			<h2 class="my-5 text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400 border-b border-gray-300 dark:border-gray-700 pb-2">
				Income Parameters
				<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100 ml-2" :data-tooltip="tooltips.incomeType">?</span>
			</h2>

			<!-- Income Type Selection -->
			<div class="flex flex-col mb-4">
				<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Income Type</label>
				<select :value="params.income.type" @change="changeIncomeType($event.target.value)"
					class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
					<option value="fixed">Fixed (with growth rate)</option>
					<option value="range">Range (different amounts per period)</option>
					<option value="manual">Manual (specify each year)</option>
				</select>
			</div>

			<!-- Fixed Income -->
			<div v-if="params.income.type === 'fixed'" class="mb-4">
				<div class="grid grid-cols-2 gap-2.5">
					<div class="flex flex-col">
						<div class="flex items-center gap-1.5">
							<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Starting Income ({{ params.currency }})</label>
							<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.incomeFixed">?</span>
						</div>
						<input type="text"
							class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
							:value="formatInputNumber(params.income.payload.start)"
							@input="params.income.payload.start = parseInputNumber($event.target.value)">
					</div>
					<div class="flex flex-col">
						<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Growth Rate (decimal)</label>
						<input type="number" v-model.number="params.income.payload.growth" step="0.01"
							class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
							placeholder="e.g., 0.03 for 3%">
					</div>
				</div>
			</div>

			<!-- Range Income -->
			<div v-if="params.income.type === 'range'" class="mb-4">
				<div class="flex items-center gap-1.5 mb-2">
					<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.incomeRange">?</span>
				</div>
				<div v-for="(range, index) in params.income.payload" :key="index" class="border border-gray-200 dark:border-gray-700 p-3 rounded-lg mb-2 bg-gray-50 dark:bg-gray-800">
					<div class="grid gap-1.5 items-end" style="grid-template-columns: minmax(0, 1fr) minmax(0, 2fr) auto;">
						<div class="flex flex-col min-w-0">
							<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">From Year</label>
							<input type="number" v-model.number="range.from" min="0" :max="params.years"
								class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
						</div>
						<div class="flex flex-col min-w-0">
							<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Income ({{ params.currency }})</label>
							<input type="text"
								class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
								:value="formatInputNumber(range.amount)"
								@input="range.amount = parseInputNumber($event.target.value)">
						</div>
						<button class="bg-danger hover:bg-dangerHover text-white px-2.5 py-1.5 rounded cursor-pointer text-sm mt-0" @click="removeIncomeRange(index)" v-if="params.income.payload.length > 1">×</button>
					</div>
				</div>
				<button @click="addIncomeRange" class="bg-primary hover:bg-secondary text-white px-3 py-1.5 rounded cursor-pointer text-xs mt-1.5">Add Range</button>
			</div>

			<!-- Manual Income -->
			<div v-if="params.income.type === 'manual'" class="mb-4">
				<div class="flex items-center gap-1.5 mb-2">
					<span class="text-sm text-gray-600 dark:text-gray-400">Specify income for each year ({{ params.income.payload.length }} years)</span>
					<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.incomeManual">?</span>
				</div>

				<!-- Bulk Actions -->
				<div class="flex gap-2 mb-2">
					<button @click="setAllManualIncome(0)" class="bg-gray-500 hover:bg-gray-600 text-white px-2 py-1 rounded cursor-pointer text-xs">
						Set All to Zero
					</button>
					<input type="text"
						ref="bulkIncomeValue"
						class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-xs w-32 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
						placeholder="Enter value"
						@input="$event.target.value = formatInputNumber(parseInputNumber($event.target.value))">
					<button @click="setAllManualIncome(parseInputNumber($refs.bulkIncomeValue.value))" class="bg-primary hover:bg-secondary text-white px-2 py-1 rounded cursor-pointer text-xs">
						Set All to Value
					</button>
				</div>

				<div class="grid grid-cols-3 gap-2 max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-700 p-3 rounded-lg bg-gray-50 dark:bg-gray-800">
					<div v-for="(amount, year) in params.income.payload" :key="year" class="flex flex-col">
						<label class="font-semibold mb-1 text-gray-600 dark:text-gray-400 text-xs">Year {{ year }}</label>
						<input type="text"
							class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-xs min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
							:value="formatInputNumber(params.income.payload[year])"
							@input="params.income.payload[year] = parseInputNumber($event.target.value)">
					</div>
				</div>
			</div>

			<!-- Expense Parameters -->
			<h2 class="my-5 text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400 border-b border-gray-300 dark:border-gray-700 pb-2">
				Expense Parameters
				<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100 ml-2" :data-tooltip="tooltips.expenseType">?</span>
			</h2>

			<!-- Expense Type Selection -->
			<div class="flex flex-col mb-4">
				<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Expense Type</label>
				<select :value="params.expense.type" @change="changeExpenseType($event.target.value)"
					class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
					<option value="fixed">Fixed (with growth rate)</option>
					<option value="range">Range (different amounts per period)</option>
					<option value="manual">Manual (specify each year)</option>
				</select>
			</div>

			<!-- Fixed Expense -->
			<div v-if="params.expense.type === 'fixed'" class="mb-4">
				<div class="grid grid-cols-2 gap-2.5">
					<div class="flex flex-col">
						<div class="flex items-center gap-1.5">
							<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Starting Expenses ({{ params.currency }})</label>
							<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.expenseFixed">?</span>
						</div>
						<input type="text"
							class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
							:value="formatInputNumber(params.expense.payload.start)"
							@input="params.expense.payload.start = parseInputNumber($event.target.value)">
					</div>
					<div class="flex flex-col">
						<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Growth Rate (decimal)</label>
						<input type="number" v-model.number="params.expense.payload.growth" step="0.01"
							class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
							placeholder="e.g., 0.03 for 3%">
					</div>
				</div>
			</div>

			<!-- Range Expense -->
			<div v-if="params.expense.type === 'range'" class="mb-4">
				<div class="flex items-center gap-1.5 mb-2">
					<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.expenseRange">?</span>
				</div>
				<div v-for="(range, index) in params.expense.payload" :key="index" class="border border-gray-200 dark:border-gray-700 p-3 rounded-lg mb-2 bg-gray-50 dark:bg-gray-800">
					<div class="grid gap-1.5 items-end" style="grid-template-columns: minmax(0, 1fr) minmax(0, 2fr) auto;">
						<div class="flex flex-col min-w-0">
							<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">From Year</label>
							<input type="number" v-model.number="range.from" min="0" :max="params.years"
								class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
						</div>
						<div class="flex flex-col min-w-0">
							<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Expenses ({{ params.currency }})</label>
							<input type="text"
								class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
								:value="formatInputNumber(range.amount)"
								@input="range.amount = parseInputNumber($event.target.value)">
						</div>
						<button class="bg-danger hover:bg-dangerHover text-white px-2.5 py-1.5 rounded cursor-pointer text-sm mt-0" @click="removeExpenseRange(index)" v-if="params.expense.payload.length > 1">×</button>
					</div>
				</div>
				<button @click="addExpenseRange" class="bg-primary hover:bg-secondary text-white px-3 py-1.5 rounded cursor-pointer text-xs mt-1.5">Add Range</button>
			</div>

			<!-- Manual Expense -->
			<div v-if="params.expense.type === 'manual'" class="mb-4">
				<div class="flex items-center gap-1.5 mb-2">
					<span class="text-sm text-gray-600 dark:text-gray-400">Specify expenses for each year ({{ params.expense.payload.length }} years)</span>
					<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.expenseManual">?</span>
				</div>

				<!-- Bulk Actions -->
				<div class="flex gap-2 mb-2">
					<button @click="setAllManualExpense(0)" class="bg-gray-500 hover:bg-gray-600 text-white px-2 py-1 rounded cursor-pointer text-xs">
						Set All to Zero
					</button>
					<input type="text"
						ref="bulkExpenseValue"
						class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-xs w-32 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
						placeholder="Enter value"
						@input="$event.target.value = formatInputNumber(parseInputNumber($event.target.value))">
					<button @click="setAllManualExpense(parseInputNumber($refs.bulkExpenseValue.value))" class="bg-primary hover:bg-secondary text-white px-2 py-1 rounded cursor-pointer text-xs">
						Set All to Value
					</button>
				</div>

				<div class="grid grid-cols-3 gap-2 max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-700 p-3 rounded-lg bg-gray-50 dark:bg-gray-800">
					<div v-for="(amount, year) in params.expense.payload" :key="year" class="flex flex-col">
						<label class="font-semibold mb-1 text-gray-600 dark:text-gray-400 text-xs">Year {{ year }}</label>
						<input type="text"
							class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-xs min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
							:value="formatInputNumber(params.expense.payload[year])"
							@input="params.expense.payload[year] = parseInputNumber($event.target.value)">
					</div>
				</div>
			</div>

			<!-- Tax Parameters -->
			<h2 class="my-5 text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400 border-b border-gray-300 dark:border-gray-700 pb-2">
				Tax Parameters
				<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100 ml-2" :data-tooltip="tooltips.taxType">?</span>
			</h2>

			<!-- Tax Type Selection -->
			<div class="flex flex-col mb-4">
				<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Tax Type</label>
				<select :value="params.tax.type" @change="changeTaxType($event.target.value)"
					class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
					<option value="fixed">Fixed (constant rate)</option>
					<option value="range">Range (different rates per period)</option>
					<option value="manual">Manual (specify each year)</option>
				</select>
			</div>

			<!-- Fixed Tax -->
			<div v-if="params.tax.type === 'fixed'" class="mb-4">
				<div class="flex flex-col">
					<div class="flex items-center gap-1.5">
						<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Tax Rate (decimal)</label>
						<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.taxFixed">?</span>
					</div>
					<input type="number" v-model.number="params.tax.payload.rate" step="0.01" min="0" max="1"
						class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
						placeholder="e.g., 0.30 for 30%">
				</div>
			</div>

			<!-- Range Tax -->
			<div v-if="params.tax.type === 'range'" class="mb-4">
				<div class="flex items-center gap-1.5 mb-2">
					<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.taxRange">?</span>
				</div>
				<div v-for="(range, index) in params.tax.payload" :key="index" class="border border-gray-200 dark:border-gray-700 p-3 rounded-lg mb-2 bg-gray-50 dark:bg-gray-800">
					<div class="grid gap-1.5 items-end" style="grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) minmax(0, 2fr) auto;">
						<div class="flex flex-col min-w-0">
							<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">From Year</label>
							<input type="number" v-model.number="range.from" min="0" :max="params.years"
								class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
						</div>
						<div class="flex flex-col min-w-0">
							<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Tax Rate (decimal)</label>
							<input type="number" v-model.number="range.rate" step="0.01" min="0" max="1"
								class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
								placeholder="0.30">
						</div>
						<div class="flex flex-col min-w-0">
							<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Est. Net Income</label>
							<input type="text" :value="formatCurrency(getEstimatedIncomeForTaxRange(range))" readonly
								class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
						</div>
						<button class="bg-danger hover:bg-dangerHover text-white px-2.5 py-1.5 rounded cursor-pointer text-sm mt-0" @click="removeTaxRange(index)" v-if="params.tax.payload.length > 1">×</button>
					</div>
				</div>
				<button @click="addTaxRange" class="bg-primary hover:bg-secondary text-white px-3 py-1.5 rounded cursor-pointer text-xs mt-1.5">Add Range</button>
			</div>

			<!-- Manual Tax -->
			<div v-if="params.tax.type === 'manual'" class="mb-4">
				<div class="flex items-center gap-1.5 mb-2">
					<span class="text-sm text-gray-600 dark:text-gray-400">Specify tax rate for each year ({{ params.tax.payload.length }} years, as decimal)</span>
					<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.taxManual">?</span>
				</div>

				<!-- Bulk Actions -->
				<div class="flex gap-2 mb-2">
					<button @click="setAllManualTax(0)" class="bg-gray-500 hover:bg-gray-600 text-white px-2 py-1 rounded cursor-pointer text-xs">
						Set All to Zero
					</button>
					<input type="number"
						ref="bulkTaxValue"
						step="0.01"
						min="0"
						max="1"
						class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-xs w-32 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
						placeholder="e.g., 0.30">
					<button @click="setAllManualTax(parseFloat($refs.bulkTaxValue.value) || 0)" class="bg-primary hover:bg-secondary text-white px-2 py-1 rounded cursor-pointer text-xs">
						Set All to Value
					</button>
				</div>

				<div class="grid grid-cols-3 gap-2 max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-700 p-3 rounded-lg bg-gray-50 dark:bg-gray-800">
					<div v-for="(rate, year) in params.tax.payload" :key="year" class="flex flex-col">
						<label class="font-semibold mb-1 text-gray-600 dark:text-gray-400 text-xs">Year {{ year }}</label>
						<input type="number" v-model.number="params.tax.payload[year]" step="0.01" min="0" max="1"
							class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-xs min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
							placeholder="0.30">
					</div>
				</div>
			</div>

			<!-- Assets -->
			<h2 class="my-5 text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400 border-b border-gray-300 dark:border-gray-700 pb-2">
				Asset Allocation
				<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100 ml-2" :data-tooltip="tooltips.assetAllocation">?</span>
			</h2>
			<div v-for="(asset, index) in params.assets" :key="index" class="border border-gray-200 dark:border-gray-700 p-3 rounded-lg mb-2 bg-gray-50 dark:bg-gray-800">
				<div class="grid gap-1.5 items-end" style="grid-template-columns: minmax(0, 2fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) auto;">
					<div class="flex flex-col min-w-0">
						<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Asset Name</label>
						<input type="text" v-model="asset.name"
							class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
					</div>
					<div class="flex flex-col min-w-0">
						<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Amount ({{ params.currency }})</label>
						<input type="text"
							class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
							:value="formatInputNumber(asset.amount)"
							@input="asset.amount = parseInputNumber($event.target.value)">
					</div>
					<div class="flex flex-col min-w-0">
						<div class="flex items-center gap-1.5">
							<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Return Rate (%)</label>
							<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.returnRate">?</span>
						</div>
						<input type="number" v-model.number="asset.rate" step="0.1"
							class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
					</div>
					<div class="flex flex-col min-w-0">
						<div class="flex items-center gap-1.5">
							<label class="font-medium mb-1 text-gray-600 dark:text-gray-400 text-xs">Liquid?</label>
							<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100" :data-tooltip="tooltips.liquid">?</span>
						</div>
						<select v-model="asset.liquid"
							class="px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary">
							<option :value="true">Yes</option>
							<option :value="false">No</option>
						</select>
					</div>
					<button class="bg-danger hover:bg-dangerHover text-white px-2.5 py-1.5 rounded cursor-pointer text-sm mt-0" @click="removeAsset(index)" v-if="params.assets.length > 1">×</button>
				</div>
			</div>
			<button @click="addAsset" class="bg-primary hover:bg-secondary text-white px-3 py-1.5 rounded cursor-pointer text-xs mt-1.5">Add Asset</button>

			<!-- Milestones -->
			<h2 class="my-5 text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400 border-b border-gray-300 dark:border-gray-700 pb-2">
				Milestones
				<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100 ml-2" :data-tooltip="tooltips.milestones">?</span>
			</h2>
			<div class="grid grid-cols-2 gap-1.5 mb-2.5">
				<div v-for="(milestone, index) in params.milestones" :key="index" class="flex gap-1.5 items-center">
					<input type="text"
						class="flex-1 px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm min-w-0 w-full bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:border-primary"
						:value="formatInputNumber(params.milestones[index])"
						@input="params.milestones[index] = parseInputNumber($event.target.value)"
						placeholder="Milestone amount (€)">
					<button class="bg-danger hover:bg-dangerHover text-white px-2.5 py-1.5 rounded cursor-pointer text-sm" @click="removeMilestone(index)">×</button>
				</div>
			</div>
			<button @click="addMilestone" class="bg-primary hover:bg-secondary text-white px-3 py-1.5 rounded cursor-pointer text-xs">Add Milestone</button>
			</div>

			<!-- Main Content with Results -->
			<div class="flex-1 p-5 overflow-y-auto relative z-[1]">
				<!-- Top toolbar with all controls -->
				<div class="flex gap-2 mb-4 items-center">
					<button v-if="sidebarCollapsed" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1.5 rounded text-xs" @click="toggleSidebar">
						→
					</button>
					<button class="bg-primary hover:bg-secondary text-white px-3 py-1.5 rounded cursor-pointer text-xs" @click="saveParameters">
						Save
					</button>
					<button class="bg-primary hover:bg-secondary text-white px-3 py-1.5 rounded cursor-pointer text-xs" @click="$refs.fileInput.click()">
						Load
					</button>
					<button class="bg-primary hover:bg-secondary text-white px-3 py-1.5 rounded cursor-pointer text-xs" @click="toggleTheme">
						{{ darkTheme ? 'Light' : 'Dark' }}
					</button>
					<input type="file" ref="fileInput" @change="loadParameters" accept=".json" class="hidden">
				</div>
			<div v-if="projection.length > 0">
				<!-- Key Metrics -->
				<h2 class="my-5 text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400 border-b border-gray-300 dark:border-gray-700 pb-2">Key Metrics</h2>
				<div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg my-4 border border-gray-200 dark:border-gray-700">
					<p class="my-1.5 text-sm text-gray-800 dark:text-gray-200"><strong class="text-gray-800 dark:text-gray-200">Initial Net Worth:</strong> {{ params.currency }}{{ formatNumber(projection[0].totalNetWorth) }}</p>
					<p class="my-1.5 text-sm text-gray-800 dark:text-gray-200"><strong class="text-gray-800 dark:text-gray-200">Final Net Worth (Year {{ params.years }}):</strong> {{ params.currency }}{{ formatNumber(projection[projection.length - 1].totalNetWorth) }}</p>
					<p class="my-1.5 text-sm text-gray-800 dark:text-gray-200"><strong class="text-gray-800 dark:text-gray-200">Total Growth:</strong> {{ params.currency }}{{ formatNumber(projection[projection.length - 1].totalNetWorth - projection[0].totalNetWorth) }}</p>
					<p class="my-1.5 text-sm text-gray-800 dark:text-gray-200"><strong class="text-gray-800 dark:text-gray-200">Total Return:</strong> {{ (((projection[projection.length - 1].totalNetWorth / projection[0].totalNetWorth) - 1) * 100).toFixed(1) }}%</p>
				</div>

				<!-- Die With Zero Analysis -->
				<h2 class="my-5 text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400 border-b border-gray-300 dark:border-gray-700 pb-2">
					Die With {{ params.currency }}<input
						type="text"
						class="inline-block w-[100px] px-1.5 py-0.5 border border-gray-300 dark:border-gray-600 rounded text-base bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-right focus:outline-none focus:border-primary mx-1"
						:value="formatInputNumber(params.targetFinalNetWorth || 0)"
						@input="updateTargetFinalNetWorth($event.target.value)"
						placeholder="0"> Analysis
					<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100 ml-2" :data-tooltip="tooltips.targetFinalNetWorth">?</span>
				</h2>
				<div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg my-4 border border-gray-200 dark:border-gray-700">
					<p class="my-1.5 text-sm text-gray-800 dark:text-gray-200"><strong class="text-gray-800 dark:text-gray-200">If you stop working NOW (year 0):</strong></p>
					<p class="my-1.5 text-sm text-gray-800 dark:text-gray-200 ml-5">Final net worth in year {{ params.years }}: {{ params.currency }}{{ formatNumber(dieWithZero.stopNow) }}</p>
					<p class="my-1.5 text-sm text-gray-800 dark:text-gray-200 mt-4"><strong class="text-gray-800 dark:text-gray-200">Optimal retirement year to reach {{ params.currency }}{{ formatNumber(dieWithZero.target) }}:</strong></p>
					<p v-if="dieWithZero.optimalYear > 0" class="my-1.5 text-sm text-gray-800 dark:text-gray-200 ml-5">
						Stop working at year {{ dieWithZero.optimalYear }}<br>
						Final net worth in year {{ params.years }}: {{ params.currency }}{{ formatNumber(dieWithZero.optimalFinalWorth) }}
					</p>
					<p v-else class="my-1.5 text-sm ml-5 text-danger">
						Cannot reach target - expenses exceed asset growth even with continued income
					</p>
				</div>

				<!-- Chart -->
				<h2 class="my-5 text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400 border-b border-gray-300 dark:border-gray-700 pb-2">Net Worth Projection</h2>
				<div class="relative h-[400px] my-5">
					<canvas ref="chart"></canvas>
				</div>

				<!-- Table -->
				<h2 class="my-5 text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400 border-b border-gray-300 dark:border-gray-700 pb-2">
					Yearly Breakdown
					<span class="tooltip-icon inline-flex items-center justify-center w-3 h-3 rounded-full bg-gray-400 text-white text-[8px] font-normal cursor-help opacity-60 hover:opacity-100 ml-2" :data-tooltip="tooltips.yearlyBreakdown">?</span>
				</h2>
				<div class="my-5">
					<table class="w-full border-collapse my-2.5 text-[0.8em]">
						<thead>
							<tr>
								<th class="px-2 py-2 text-right border-b-2 border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 font-medium text-xs uppercase tracking-wide sticky top-0">Year</th>
								<th class="px-2 py-2 text-right border-b-2 border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 font-medium text-xs uppercase tracking-wide sticky top-0">Age</th>
								<th class="px-2 py-2 text-right border-b-2 border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 font-medium text-xs uppercase tracking-wide sticky top-0">Gross Income</th>
								<th class="px-2 py-2 text-right border-b-2 border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 font-medium text-xs uppercase tracking-wide sticky top-0">Tax</th>
								<th class="px-2 py-2 text-right border-b-2 border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 font-medium text-xs uppercase tracking-wide sticky top-0">Net Income</th>
								<th class="px-2 py-2 text-right border-b-2 border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 font-medium text-xs uppercase tracking-wide sticky top-0">Expenses</th>
								<th class="px-2 py-2 text-right border-b-2 border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 font-medium text-xs uppercase tracking-wide sticky top-0">Savings</th>
								<th v-for="asset in params.assets" :key="asset.name" class="px-2 py-2 text-right border-b-2 border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 font-medium text-xs uppercase tracking-wide sticky top-0">{{ asset.name }}</th>
								<th class="px-2 py-2 text-right border-b-2 border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 font-medium text-xs uppercase tracking-wide sticky top-0">Total Net Worth</th>
							</tr>
						</thead>
						<tbody>
							<tr v-for="row in projection" :key="row.year" class="hover:bg-gray-100 dark:hover:bg-gray-800">
								<td class="px-2 py-1.5 text-right border-b border-gray-200 dark:border-gray-600 text-gray-800 dark:text-gray-200">{{ row.year }}</td>
								<td class="px-2 py-1.5 text-right border-b border-gray-200 dark:border-gray-600 text-gray-800 dark:text-gray-200">{{ params.currentAge + row.year }}</td>
								<td class="px-2 py-1.5 text-right border-b border-gray-200 dark:border-gray-600 text-gray-800 dark:text-gray-200">{{ params.currency }}{{ formatNumber(row.grossIncome) }}</td>
								<td class="px-2 py-1.5 text-right border-b border-gray-200 dark:border-gray-600 text-gray-800 dark:text-gray-200">{{ formatNumber(row.tax) }}%</td>
								<td class="px-2 py-1.5 text-right border-b border-gray-200 dark:border-gray-600 text-gray-800 dark:text-gray-200">{{ params.currency }}{{ formatNumber(row.netIncome) }}</td>
								<td class="px-2 py-1.5 text-right border-b border-gray-200 dark:border-gray-600 text-gray-800 dark:text-gray-200">{{ params.currency }}{{ formatNumber(row.expenses) }}</td>
								<td class="px-2 py-1.5 text-right border-b border-gray-200 dark:border-gray-600" :class="row.savings > 0 ? 'text-green-600' : (row.savings < 0 ? 'text-danger' : 'text-gray-800 dark:text-gray-200')">{{ params.currency }}{{ formatNumber(Math.abs(row.savings)) }}</td>
								<td v-for="asset in params.assets" :key="asset.name" class="px-2 py-1.5 text-right border-b border-gray-200 dark:border-gray-600 text-gray-800 dark:text-gray-200">
									<div>{{ params.currency }}{{ formatNumber(row.assets[asset.name] || 0) }}</div>
									<div v-if="row.year > 0 && (row.assetAppreciation[asset.name] > 0 || row.assetContributions[asset.name] > 0 || row.assetLosses[asset.name] > 0)" class="block text-[0.75em] mt-0.5 whitespace-nowrap">
										<span v-if="row.assetAppreciation[asset.name] > 0" class="text-green-600 mr-2">↑{{ params.currency }}{{ formatNumber(row.assetAppreciation[asset.name]) }}</span>
										<span v-if="row.assetContributions[asset.name] > 0" class="text-green-500 mr-2">↑↑{{ params.currency }}{{ formatNumber(row.assetContributions[asset.name]) }}</span>
										<span v-if="row.assetLosses[asset.name] > 0" class="text-danger">↓{{ params.currency }}{{ formatNumber(row.assetLosses[asset.name]) }}</span>
									</div>
								</td>
								<td class="px-2 py-1.5 text-right border-b border-gray-200 dark:border-gray-600 text-gray-800 dark:text-gray-200">
									<div><strong>{{ params.currency }}{{ formatNumber(row.totalNetWorth) }}</strong></div>
									<div v-if="row.year > 0 && row.netWorthChange !== 0" class="block text-[0.75em] mt-0.5 whitespace-nowrap">
										<span :class="row.netWorthChange > 0 ? 'text-green-600' : 'text-danger'">
											{{ row.netWorthChange > 0 ? '↑' : '↓' }}{{ params.currency }}{{ formatNumber(Math.abs(row.netWorthChange)) }}
										</span>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			</div>
		</div>
	</div>

	<!-- Application JavaScript -->
	<script type="module" src="./main.ts"></script>
</body>
</html>
